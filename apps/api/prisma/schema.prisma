generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Technician {
  id            String         @id @default(uuid())
  email         String         @unique
  phone         String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  customMessage String?
  servicePrices Json?
  firstName     String
  lastName      String
  password      String
  websiteURL    String?
  city          String?
  companyName   String?
  currency      String?
  state         String?
  timezone      String?
  zipCode       String?
  address       String?
  appointments  Appointment[]
  availability  Availability[]
  customers     Customer[]
  services      Service[]
  serviceAreas  ServiceArea[]
  serviceTypes  ServiceType[]
}

model ServiceArea {
  id           String     @id @default(uuid())
  zipCode      String
  technicianId String
  technician   Technician @relation(fields: [technicianId], references: [id])
}

model Customer {
  id             String        @id @default(uuid())
  techId         String
  phone          String
  email          String?
  address        String
  referralCode   String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  firstName      String
  lastName       String
  companyName    String?
  emailUpdates   Boolean       @default(true)
  textUpdates    Boolean       @default(true)
  city           String?
  state          String?
  zipCode        String?
  appointments   Appointment[]
  tech           Technician    @relation(fields: [techId], references: [id])
  pianos         Piano[]
  serviceHistory Service[]
}

model Piano {
  id              String        @id @default(uuid())
  customerId      String
  type            String
  brand           String?
  model           String?
  serialNumber    String?
  lastServiceDate DateTime?
  notes           String?
  year            Int?
  appointments    Appointment[]
  customer        Customer      @relation(fields: [customerId], references: [id])
  services        Service[]
}

model Service {
  id            String      @id @default(uuid())
  techId        String
  pianoId       String
  customerId    String
  serviceTypeId String
  notes         String?
  serviceDate   DateTime    @default(now())
  customer      Customer    @relation(fields: [customerId], references: [id])
  piano         Piano       @relation(fields: [pianoId], references: [id])
  serviceType   ServiceType @relation(fields: [serviceTypeId], references: [id])
  tech          Technician  @relation(fields: [techId], references: [id])
}

model ServiceType {
  id           String        @id @default(cuid())
  name         String
  description  String
  duration     String
  price        Float
  createdAt    DateTime      @default(now())
  technicianId String
  updatedAt    DateTime      @updatedAt
  appointments Appointment[]
  services     Service[]
  technician   Technician    @relation(fields: [technicianId], references: [id])
}

model Appointment {
  id            String      @id @default(uuid())
  technicianId  String
  customerId    String
  pianoId       String
  serviceTypeId String
  scheduledAt   DateTime
  timeSlot      String?
  notes         String?
  createdAt     DateTime    @default(now())
  customer      Customer    @relation(fields: [customerId], references: [id])
  piano         Piano       @relation(fields: [pianoId], references: [id])
  serviceType   ServiceType @relation(fields: [serviceTypeId], references: [id])
  technician    Technician  @relation(fields: [technicianId], references: [id])
}

model Availability {
  id        String     @id @default(uuid())
  dayOfWeek String
  startTime String
  endTime   String
  techId    String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  tech      Technician @relation(fields: [techId], references: [id])

  @@unique([techId, dayOfWeek])
}
